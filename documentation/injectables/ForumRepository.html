<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>msforum-grpc documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">msforum-grpc documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">







<ol class="breadcrumb">
  <li>Injectables</li>
  <li>ForumRepository</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/forum/forum.repository.ts</code>
        </p>




            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#createPost">createPost</a>
                            </li>
                            <li>
                                <a href="#createPostComment">createPostComment</a>
                            </li>
                            <li>
                                <a href="#createPostReaction">createPostReaction</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#dbClient">dbClient</a>
                            </li>
                            <li>
                                <a href="#getCategoryById">getCategoryById</a>
                            </li>
                            <li>
                                <a href="#getPostById">getPostById</a>
                            </li>
                            <li>
                                <a href="#listMainCategories">listMainCategories</a>
                            </li>
                            <li>
                                <a href="#listPostComments">listPostComments</a>
                            </li>
                            <li>
                                <a href="#listPostsByCategoryId">listPostsByCategoryId</a>
                            </li>
                            <li>
                                <a href="#listSubcategories">listSubcategories</a>
                            </li>
                            <li>
                                <a href="#updatePost">updatePost</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(dynamodbService: <a href="../injectables/DynamodbService.html">DynamodbService</a>, police: <a href="../injectables/ForumPolice.html">ForumPolice</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="23" class="link-to-prism">src/forum/forum.repository.ts:23</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>dynamodbService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/DynamodbService.html" target="_self" >DynamodbService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>police</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/ForumPolice.html" target="_self" >ForumPolice</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createPost"></a>
                    <span class="name">
                        <b>
                            createPost
                        </b>
                        <a href="#createPost"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>createPost(payload: ICreatePost_Request)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="174"
                            class="link-to-prism">src/forum/forum.repository.ts:174</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>payload</td>
                                    <td>
                                            <code>ICreatePost_Request</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;IPost&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createPostComment"></a>
                    <span class="name">
                        <b>
                            createPostComment
                        </b>
                        <a href="#createPostComment"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>createPostComment(payload: ICreatePostComment_Request)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="240"
                            class="link-to-prism">src/forum/forum.repository.ts:240</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>payload</td>
                                    <td>
                                            <code>ICreatePostComment_Request</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;ICreatePostComment_Response&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createPostReaction"></a>
                    <span class="name">
                        <b>
                            createPostReaction
                        </b>
                        <a href="#createPostReaction"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>createPostReaction(payload: ICreatePostReaction_Request)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="273"
                            class="link-to-prism">src/forum/forum.repository.ts:273</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>payload</td>
                                    <td>
                                            <code>ICreatePostReaction_Request</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;ICreatePostReaction_Response&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="dbClient"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Private</span>
                            dbClient
                        </b>
                        <a href="#dbClient"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>dbClient()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="29"
                            class="link-to-prism">src/forum/forum.repository.ts:29</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>    <code>DocumentClient</code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getCategoryById"></a>
                    <span class="name">
                        <b>
                            getCategoryById
                        </b>
                        <a href="#getCategoryById"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getCategoryById(categoryId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="33"
                            class="link-to-prism">src/forum/forum.repository.ts:33</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>categoryId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;ICategory&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getPostById"></a>
                    <span class="name">
                        <b>
                            getPostById
                        </b>
                        <a href="#getPostById"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getPostById(postId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="53"
                            class="link-to-prism">src/forum/forum.repository.ts:53</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>postId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;IPost&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="listMainCategories"></a>
                    <span class="name">
                        <b>
                            listMainCategories
                        </b>
                        <a href="#listMainCategories"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>listMainCategories()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="75"
                            class="link-to-prism">src/forum/forum.repository.ts:75</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;ICategory[]&gt;</code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="listPostComments"></a>
                    <span class="name">
                        <b>
                            listPostComments
                        </b>
                        <a href="#listPostComments"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>listPostComments(postId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="151"
                            class="link-to-prism">src/forum/forum.repository.ts:151</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>postId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;IPostComment[]&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="listPostsByCategoryId"></a>
                    <span class="name">
                        <b>
                            listPostsByCategoryId
                        </b>
                        <a href="#listPostsByCategoryId"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>listPostsByCategoryId(categoryId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="129"
                            class="link-to-prism">src/forum/forum.repository.ts:129</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>categoryId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;IPost[]&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="listSubcategories"></a>
                    <span class="name">
                        <b>
                            listSubcategories
                        </b>
                        <a href="#listSubcategories"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>listSubcategories(categoryId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="107"
                            class="link-to-prism">src/forum/forum.repository.ts:107</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>categoryId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;ICategory[]&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updatePost"></a>
                    <span class="name">
                        <b>
                            updatePost
                        </b>
                        <a href="#updatePost"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>updatePost(payload: IUpdatePost_Request)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="207"
                            class="link-to-prism">src/forum/forum.repository.ts:207</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>payload</td>
                                    <td>
                                            <code>IUpdatePost_Request</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;IPost&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable } from &#x27;@nestjs/common&#x27;;
import { AWSError } from &#x27;aws-sdk&#x27;;
import { v4 as uuidv4 } from &#x27;uuid&#x27;;
import { DocumentClient } from &#x27;aws-sdk/clients/dynamodb&#x27;;
import {
  ICategory,
  ICreatePostComment_Request,
  ICreatePostComment_Response,
  ICreatePostReaction_Request,
  ICreatePostReaction_Response,
  ICreatePost_Request,
  IPost,
  IPostComment,
  IPostReaction,
  IUpdatePost_Request,
} from &#x27;msforum-grpc&#x27;;
import { DynamodbService } from &#x27;src/dynamodb/dynamodb.service&#x27;;
import { TableName } from &#x27;src/dynamodb/dynamodb.utils&#x27;;
import { ForumPolice } from &#x27;./forum.police&#x27;;
import { defaultValue } from &#x27;src/utils&#x27;;

@Injectable()
export class ForumRepository {
  constructor(
    private readonly dynamodbService: DynamodbService,
    private readonly police: ForumPolice,
  ) {}

  private dbClient(): DocumentClient {
    return this.dynamodbService.getDBClient();
  }

  getCategoryById(categoryId: string): Promise&lt;ICategory&gt; {
    return new Promise((resolve, reject) &#x3D;&gt; {
      this.dbClient().get(
        {
          TableName: TableName(&#x27;categories&#x27;),
          Key: {
            id: String(categoryId),
          },
        },
        (err: AWSError, data: DocumentClient.GetItemOutput) &#x3D;&gt; {
          if (err) {
            reject(err);
            return;
          }
          resolve(data.Item as ICategory);
        },
      );
    });
  }

  getPostById(postId: string): Promise&lt;IPost&gt; {
    return new Promise((resolve, reject) &#x3D;&gt; {
      this.dbClient().get(
        {
          TableName: TableName(&#x27;posts&#x27;),
          Key: {
            id: postId,
          },
        },
        (err: AWSError, data: DocumentClient.GetItemOutput) &#x3D;&gt; {
          if (err) {
            reject(err);
            return;
          }
          resolve(data.Item as IPost);
        },
      );
    });
  }

  // Aws SDK docs
  // https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/dynamodb-example-query-scan.html
  listMainCategories(): Promise&lt;ICategory[]&gt; {
    return new Promise((resolve, reject) &#x3D;&gt; {
      // Query operators on Dynamodb
      // https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Expressions.OperatorsAndFunctions.html
      this.dbClient().scan(
        {
          TableName: TableName(&#x27;categories&#x27;),
          FilterExpression:
            &#x27;attribute_not_exists(parentId) or parentId &#x3D; :empty&#x27;,
          ExpressionAttributeValues: {
            &#x27;:empty&#x27;: null,
          },
        },
        (err: AWSError, data: DocumentClient.QueryOutput) &#x3D;&gt; {
          if (err) {
            reject(err);
            return;
          }
          /***********************************
           * data:
           * {
           *   Items: [{id: &#x27;1&#x27;, title: &#x27;Category 1&#x27;,...}],
           *   Count: 1,
           *   ScannedCount: 1
           * }
           */
          resolve(data.Items as ICategory[]);
        },
      );
    });
  }

  listSubcategories(categoryId: string): Promise&lt;ICategory[]&gt; {
    return new Promise((resolve, reject) &#x3D;&gt; {
      this.dbClient().query(
        {
          TableName: TableName(&#x27;categories&#x27;),
          IndexName: &#x27;WithParentId&#x27;,
          KeyConditionExpression: &#x27;parentId &#x3D; :parentId&#x27;,
          ExpressionAttributeValues: {
            &#x27;:parentId&#x27;: categoryId,
          },
        },
        (err: AWSError, data: DocumentClient.QueryOutput) &#x3D;&gt; {
          if (err) {
            reject(err);
            return;
          }
          resolve(data.Items as ICategory[]);
        },
      );
    });
  }

  listPostsByCategoryId(categoryId: string): Promise&lt;IPost[]&gt; {
    return new Promise((resolve, reject) &#x3D;&gt; {
      this.dbClient().query(
        {
          TableName: TableName(&#x27;posts&#x27;),
          IndexName: &#x27;WithCategoryId&#x27;,
          KeyConditionExpression: &#x27;categoryId &#x3D; :categoryId&#x27;,
          ExpressionAttributeValues: {
            &#x27;:categoryId&#x27;: categoryId,
          },
        },
        (err: AWSError, data: DocumentClient.QueryOutput) &#x3D;&gt; {
          if (err) {
            reject(err);
            return;
          }
          resolve(data.Items as IPost[]);
        },
      );
    });
  }

  listPostComments(postId: string): Promise&lt;IPostComment[]&gt; {
    return new Promise((resolve, reject) &#x3D;&gt; {
      this.dbClient().query(
        {
          TableName: TableName(&#x27;comments&#x27;),
          IndexName: &#x27;WithPostId&#x27;,
          KeyConditionExpression: &#x27;postId &#x3D; :postId&#x27;,
          ExpressionAttributeValues: {
            &#x27;:postId&#x27;: postId,
          },
          Select: &#x27;ALL_ATTRIBUTES&#x27;,
        },
        (err: AWSError, data: DocumentClient.QueryOutput) &#x3D;&gt; {
          if (err) {
            reject(err);
            return;
          }
          resolve(data.Items as IPostComment[]);
        },
      );
    });
  }

  createPost(payload: ICreatePost_Request): Promise&lt;IPost&gt; {
    return new Promise((resolve, reject) &#x3D;&gt; {
      const { createdBy, title, excerpt, content, categoryId } &#x3D; payload;

      const post: IPost &#x3D; {
        id: uuidv4(),
        commentsCount: 0,
        createdAt: new Date().toISOString(),
        postType: &#x27;post&#x27;,
        postState: &#x27;open&#x27;,
        createdBy,
        title,
        excerpt,
        content,
        categoryId,
      };

      this.dbClient().put(
        {
          TableName: TableName(&#x27;posts&#x27;),
          Item: this.police.sanitizePost(post),
        },
        (err: AWSError) &#x3D;&gt; {
          if (err) {
            reject(err);
            return;
          }
          resolve(post);
        },
      );
    });
  }

  updatePost(payload: IUpdatePost_Request): Promise&lt;IPost&gt; {
    return new Promise(async (resolve, reject) &#x3D;&gt; {
      const post &#x3D; await this.getPostById(payload.id);

      if (String(post.createdBy) !&#x3D;&#x3D; String(payload.createdBy)) {
        // @TODO ~ Throw correct error
        reject(new Error(&#x60;Invalid author&#x60;));
      }

      post.title &#x3D; defaultValue(payload.title, post.title, false);
      post.excerpt &#x3D; defaultValue(payload.excerpt, post.excerpt, false);
      post.postType &#x3D; defaultValue(payload.postType, post.postType, false);
      post.postState &#x3D; defaultValue(payload.postState, post.postState, false);
      post.content &#x3D; defaultValue(payload.content, post.content, false);

      const Item &#x3D; this.police.sanitizePost(post);

      this.dbClient().put(
        {
          TableName: TableName(&#x27;posts&#x27;),
          Item,
        },
        (err: AWSError) &#x3D;&gt; {
          if (err) {
            reject(err);
            return;
          }
          resolve(Item);
        },
      );
    });
  }

  createPostComment(
    payload: ICreatePostComment_Request,
  ): Promise&lt;ICreatePostComment_Response&gt; {
    return new Promise((resolve, reject) &#x3D;&gt; {
      const { postId, parentId, createdBy, content } &#x3D; payload;

      const comment: IPostComment &#x3D; {
        id: uuidv4(),
        postId,
        parentId,
        createdBy,
        content,
        createdAt: new Date().toISOString(),
      };

      const Item &#x3D; this.police.sanitizePostComment(comment);

      this.dbClient().put(
        {
          TableName: TableName(&#x27;comments&#x27;),
          Item,
        },
        (err: AWSError) &#x3D;&gt; {
          if (err) {
            reject(err);
            return;
          }
          resolve(comment);
        },
      );
    });
  }

  createPostReaction(
    payload: ICreatePostReaction_Request,
  ): Promise&lt;ICreatePostReaction_Response&gt; {
    return new Promise((resolve, reject) &#x3D;&gt; {
      const { postId, commentId, reactType, createdBy } &#x3D; payload;

      const reaction: IPostReaction &#x3D; {
        id: uuidv4(),
        postId,
        commentId,
        reactType,
        createdBy,
        createdAt: new Date().toISOString(),
      };

      const Item &#x3D; this.police.sanitizePostReaction(reaction);

      this.dbClient().put(
        {
          TableName: TableName(&#x27;reactions&#x27;),
          Item,
        },
        (err: AWSError) &#x3D;&gt; {
          if (err) {
            reject(err);
            return;
          }
          resolve(reaction);
        },
      );
    });
  }
}
</code></pre>
    </div>

</div>







                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'ForumRepository.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
